<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>YOLOv8 图片检测</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
  <script src="https://cdn.jsdelivr.net/npm/onnxruntime-web/dist/ort.js"></script>
  <script src="{{ url_for('static', filename='js/main.js') }}" defer></script>
</head>
<body>
  <div class="page">
    <header class="hero">
      <div>
        <h1>基于YOLOv8的图片检测系统</h1>
        <p class="sub">不同计算分区策略的性能比较</p>
      </div>

    </header>

    <section class="card controls">
      <div class="form-group">
        <label for="fileInput">选择图片 (jpg/jpeg/png)</label>
        <input type="file" id="fileInput" accept=".jpg,.jpeg,.png">
        <p id="fileInfo" class="muted">未选择文件</p>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="strategySelect">策略</label>
          <select id="strategySelect">
            <option value="A">Strategy A · Server only</option>
            <option value="B">Strategy B · Client preprocess + Server infer + Client draw</option>
            <option value="C">Strategy C · Client-only (Web ONNX)</option>
          </select>
        </div>
        <div class="actions">
          <button id="startBtn" class="btn primary">开始检测</button>
        </div>
      </div>

      <div class="status-bar">
        <div class="spinner hidden" id="spinner"></div>
        <div class="progress">
          <div id="progressBar"></div>
        </div>
        <div id="statusText" class="status-text">等待开始…</div>
      </div>
    </section>

    <section class="card media">
      <div class="panel-header">
        <h3>各策略独立结果</h3>
      </div>
      <div class="strategy-grid">
        <div class="strategy-card" id="panel-a">
          <div class="strategy-title">Strategy A · Server only</div>
          <div class="media-pair">
            <div class="media-slot">
              <p class="slot-label">原始</p>
              <img id="original-a-image" class="media-view hidden" alt="A original">
            </div>
            <div class="media-slot">
              <p class="slot-label">检测结果</p>
              <img id="detected-a-image" class="media-view hidden" alt="A detected">
            </div>
          </div>
          <div class="links">
            <a id="download-a-original" class="btn ghost" href="#" download>下载原始</a>
            <a id="download-a-result" class="btn ghost" href="#" download>下载结果</a>
          </div>
        </div>

        <div class="strategy-card" id="panel-b">
          <div class="strategy-title">Strategy B · Client preprocess + Server infer + Client draw</div>
          <div class="media-pair">
            <div class="media-slot">
              <p class="slot-label">原始</p>
              <img id="original-b-image" class="media-view hidden" alt="B original">

            </div>
            <div class="media-slot">
              <p class="slot-label">检测结果</p>
              <img id="detected-b-image" class="media-view hidden" alt="B detected">

              <canvas id="detected-b-canvas" class="media-view hidden"></canvas>
            </div>
          </div>
          <div class="links">
            <a id="download-b-original" class="btn ghost" href="#" download>下载原始</a>
            <a id="download-b-result" class="btn ghost" href="#" download>下载结果</a>
          </div>
        </div>

        <div class="strategy-card" id="panel-c">
          <div class="strategy-title">Strategy C · Client-only (Web ONNX)</div>
          <div class="media-pair">
            <div class="media-slot">
              <p class="slot-label">原始</p>
              <img id="original-c-image" class="media-view hidden" alt="C original">

            </div>
            <div class="media-slot">
              <p class="slot-label">检测结果</p>
              <img id="detected-c-image" class="media-view hidden" alt="C detected">

              <canvas id="detected-c-canvas" class="media-view hidden"></canvas>
            </div>
          </div>
          <div class="links">
            <a id="download-c-original" class="btn ghost" href="#" download>下载原始</a>
            <a id="download-c-result" class="btn ghost" href="#" download>下载结果</a>
          </div>
        </div>
      </div>
    </section>

    <section class="card metrics note">
      <div class="panel-header">
        <h3>性能统计</h3>
        <p class="muted">单位：秒；“N/A” 表示该策略不涉及该阶段。</p>
      </div>
      <table>
        <thead>
          <tr>
            <th>指标</th>
            <th>Strategy A</th>
            <th>Strategy B</th>
            <th>Strategy C</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>上传图片大小</td>
            <td id="metric-size-a">—</td>
            <td id="metric-size-b">—</td>
            <td id="metric-size-c" class="muted">N/A</td>
          </tr>
          <tr>
            <td>客户端预处理与上传</td>
            <td id="metric-client-preupload-a">—</td>
            <td id="metric-client-preupload-b">—</td>
            <td id="metric-client-preupload-c" class="muted">N/A</td>
          </tr>
          <tr>
            <td>服务器接收与预处理</td>
            <td id="metric-server-recvpre-a">—</td>
            <td id="metric-server-recvpre-b">—</td>
            <td id="metric-server-recvpre-c" class="muted">N/A</td>
          </tr>
          <tr>
            <td>服务器模型推理</td>
            <td id="metric-infer-a">—</td>
            <td id="metric-infer-b">—</td>
            <td id="metric-infer-c" class="muted">N/A</td>
          </tr>
          <tr>
            <td>服务器后处理</td>
            <td id="metric-post-a">—</td>
            <td id="metric-post-b">—</td>
            <td id="metric-post-c" class="muted">N/A</td>
          </tr>
          <tr>
            <td>客户端渲染</td>
            <td id="metric-client-render-a">—</td>
            <td id="metric-client-render-b">—</td>
            <td id="metric-client-render-c" class="muted">N/A</td>
          </tr>
          <tr>
            <td>端到端耗时</td>
            <td id="metric-total-a">—</td>
            <td id="metric-total-b">—</td>
            <td id="metric-total-c">—</td>
          </tr>
        </tbody>
      </table>
      <ul>
        <li><strong>上传图片大小</strong>：A=原始图片体积；B=客户端预处理后上传的图片体积；C=N/A。</li>
        <li><strong>客户端预处理与上传</strong>：A=本地读取+直传；B=读取+压缩/缩放/归一化后上传；C=N/A。</li>
        <li><strong>服务器接收与预处理</strong>：A=接收原图、解码并构建模型输入；B=接收已预处理图并做轻量转换/校验；C=N/A。</li>
        <li><strong>服务器模型推理</strong>：A/B=服务器前向计算耗时；C=N/A。</li>
        <li><strong>服务器后处理</strong>：A=NMS+绘制+编码成图后返回；B=仅NMS与结果序列化（不绘制）；C=N/A。</li>
        <li><strong>客户端渲染</strong>：A=加载显示服务器返回成图；B=浏览器中绘制检测框/标签并生成结果图；C=N/A。</li>
        <li><strong>端到端耗时</strong>：A/B/C=从点击开始到结果呈现的总耗时（含各自适用阶段）。</li>
      </ul>
    </section>

    <section class="card note">
      <h3>策略说明</h3>
      <ul>
        <li><strong>Strategy A</strong>：仅服务器侧执行；客户端上传原图，服务器完成预处理、推理与标注后返回成图。</li>
        <li><strong>Strategy B</strong>：前后端协同；客户端做轻量预处理并上传，服务器仅推理返回检测框，客户端本地绘制。</li>
        <li><strong>Strategy C</strong>：纯前端；浏览器使用 Web ONNX 在本地完成预处理、推理与绘制，无需服务器参与。</li>
      </ul>
    </section>
  </div>
</body>
</html>
